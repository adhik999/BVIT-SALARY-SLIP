<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teacher Login & Registration - BVIT SALARY SLIP</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="icon" type="image/x-icon" href="../public/favicon.ico" />
    
    <!-- Firebase Integration -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="../config/firebase-config.js"></script>
    <script src="../js/firebase-db.js"></script>
    
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fteacherpay1871back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.7"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-primary-50 via-background to-secondary-50">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-5">
        <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                    <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
                </pattern>
            </defs>
            <rect width="100" height="100" fill="url(#grid)"/>
        </svg>
    </div>

    <!-- Educational Background Elements -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-32 h-32 bg-accent-100 rounded-full opacity-20 blur-xl"></div>
        <div class="absolute bottom-20 right-10 w-40 h-40 bg-primary-100 rounded-full opacity-20 blur-xl"></div>
        <div class="absolute top-1/2 left-1/4 w-24 h-24 bg-secondary-100 rounded-full opacity-15 blur-lg"></div>
    </div>

    <!-- Main Container -->
    <div class="relative min-h-screen flex items-center justify-center px-4 py-12">
        <div class="w-full max-w-lg">
            <!-- Logo and Branding -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center mb-4">
                    <img src="../public/bharati_logo.png" alt="Bharati Vidyapeeth Logo" class="object-contain" style="width: auto; height: auto; max-width: 120px; max-height: 120px;" />
                </div>
                <h1 class="text-fluid-3xl font-bold text-text-primary mb-2">BVIT SALARY SLIP</h1>
                <p class="text-fluid-base text-text-secondary font-caption">Salary Management System</p>
            </div>

            <!-- Mode Toggle -->
            <div class="glass-card p-2 mb-6 shadow-elevation-2">
                <div class="flex bg-secondary-50 rounded-lg p-1">
                    <button id="login-mode-btn" class="flex-1 px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 bg-white text-primary shadow-subtle">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        Login
                    </button>
                    <button id="register-mode-btn" class="flex-1 px-4 py-2 text-sm font-medium rounded-md transition-all duration-200 text-text-secondary hover:text-text-primary">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                        </svg>
                        Register
                    </button>
                </div>
            </div>

            <!-- Login Form Card -->
            <div id="login-form-card" class="glass-card p-8 shadow-elevation-3">

                <!-- Success Message (Hidden by default) -->
                <div id="login-success-message" class="hidden mb-4 p-3 bg-success-50 border border-success-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-success-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-sm text-success-700" id="login-success-text">Login successful! Redirecting...</span>
                    </div>
                </div>

                <!-- Error Message (Hidden by default) -->
                <div id="login-error-message" class="hidden mb-4 p-3 bg-error-50 border border-error-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-error-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-sm text-error-700" id="login-error-text">Invalid credentials. Please check your Teacher ID and password.</span>
                    </div>
                </div>

                <form id="teacher-login-form" class="space-y-6">
                    <!-- Teacher ID/Email Field -->
                    <div>
                        <label for="login-teacherId" class="form-label">Teacher ID / Email Address</label>
                        <div class="relative">
                            <input type="text" id="login-teacherId" name="teacherId" class="form-input pl-10" placeholder="Enter your Teacher ID or email" required autocomplete="username" />
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                            </div>
                        </div>
                        <p class="mt-1 text-xs text-text-secondary font-caption">Use your institutional Teacher ID (e.g., TCH001) or email address</p>
                    </div>

                    <!-- Password Field -->
                    <div>
                        <label for="login-password" class="form-label">Password</label>
                        <div class="relative">
                            <input type="password" id="login-password" name="password" class="form-input pl-10 pr-10" placeholder="Enter your password" required autocomplete="current-password" />
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                </svg>
                            </div>
                            <button type="button" id="toggle-login-password" class="absolute inset-y-0 right-0 pr-3 flex items-center focus:outline-none">
                                <svg id="login-eye-closed" class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"/>
                                </svg>
                                <svg id="login-eye-open" class="w-4 h-4 text-secondary-400 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Remember Me and Forgot Password -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-accent focus:ring-accent-500 border-secondary-300 rounded" />
                            <label for="remember-me" class="ml-2 block text-sm text-text-secondary font-caption">
                                Remember me
                            </label>
                        </div>
                        <div class="text-sm">
                            <a href="javascript:void(0)" class="font-medium text-accent hover:text-accent-700 transition-colors duration-200">
                                Forgot password?
                            </a>
                        </div>
                    </div>

                    <!-- Login Button -->
                    <div>
                        <button type="submit" id="login-btn" class="w-full btn-accent py-3 text-base font-medium relative overflow-hidden">
                            <span id="login-text">Sign In</span>
                            <div id="login-spinner" class="hidden absolute inset-0 flex items-center justify-center">
                                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                </svg>
                            </div>
                        </button>
                    </div>
                </form>

                <!-- Alternative Login -->
                <div class="mt-6 text-center">
                    <p class="text-sm text-text-secondary font-caption">
                        Are you an administrator? 
                        <a href="pages/admin_login.html" class="font-medium text-primary hover:text-primary-700 transition-colors duration-200">
                            Sign in here
                        </a>
                    </p>
                </div>
            </div>

            <!-- Registration Form Card -->
            <div id="registration-form-card" class="hidden glass-card p-8 shadow-elevation-3">
                <div class="mb-6">
                    <h2 class="text-fluid-xl font-semibold text-text-primary mb-2">Join BVIT SALARY SLIP</h2>
                    <p class="text-text-secondary font-caption">Register to access your salary information</p>
                </div>

                <!-- Registration Success Message -->
                <div id="register-success-message" class="hidden mb-4 p-3 bg-success-50 border border-success-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-success-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-sm text-success-700" id="register-success-text">Registration successful! Please wait for admin approval.</span>
                    </div>
                </div>

                <!-- Registration Error Message -->
                <div id="register-error-message" class="hidden mb-4 p-3 bg-error-50 border border-error-200 rounded-md">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 text-error-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="text-sm text-error-700" id="register-error-text">Registration failed. Please try again.</span>
                    </div>
                </div>

                <form id="teacher-registration-form" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Full Name -->
                        <div class="md:col-span-2">
                            <label for="fullName" class="form-label">Full Name *</label>
                            <div class="relative">
                                <input type="text" id="fullName" name="fullName" class="form-input pl-10" placeholder="Dr. Priya Sharma" required />
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Email -->
                        <div>
                            <label for="email" class="form-label">Email Address *</label>
                            <div class="relative">
                                <input type="email" id="email" name="email" class="form-input pl-10" placeholder="your.email@school.edu" required />
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Phone -->
                        <div>
                            <label for="phone" class="form-label">Phone Number *</label>
                            <div class="relative">
                                <input type="tel" id="phone" name="phone" class="form-input pl-10" placeholder="+91 98765 43210" required />
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Department -->
                        <div>
                            <label for="department" class="form-label">Department *</label>
                            <select id="department" name="department" class="form-input" required>
                                <option value>Select Department</option>
                                <option value="Information Technology">Information Technology (IT)</option>
                                <option value="Computer Technology">Computer Technology (CT)</option>
                                <option value="Artificial Intelligence">Artificial Intelligence (AI)</option>
                                <option value="Mechanical Engineering">Mechanical Engineering (ME)</option>
                                <option value="Civil Engineering">Civil Engineering (CE)</option>
                                <option value="Electrical Engineering">Electrical Engineering (EE)</option>
                                <option value="Electronics & Telecommunication">Electronics & Telecommunication (ET)</option>
                                <option value="OFFICE">OFFICE</option>
                                <option value="LIBRARY">LIBRARY</option>
                            </select>
                        </div>

                        <!-- Designation -->
                        <div>
                            <label for="designation" class="form-label">Designation *</label>
                            <select id="designation" name="designation" class="form-input" required>
                                <option value>Select Designation</option>
                                <option value="Principal">Principal</option>
                                <option value="Vice Principal">Vice Principal</option>
                                <option value="HOD">HOD</option>
                                <option value="Lecturer">Lecturer</option>
                                <option value="Lab Assistant">Lab Assistant</option>
                                <option value="Lab Attendant">Lab Attendant</option>
                                <option value="Instructor">Instructor</option>
                                <option value="Jr. Librarian">Jr. Librarian</option>
                                <option value="Accountant">Accountant</option>
                                <option value="Clerk">Clerk</option>
                                <option value="Peon">Peon</option>
                                <option value="Tech Lab Assistant">Tech Lab Assistant</option>
                            </select>
                        </div>


                        <!-- Teacher ID -->
                        <div>
                            <label for="teacherId" class="form-label">Preferred Teacher ID</label>
                            <input type="text" id="teacherId" name="teacherId" class="form-input font-data" placeholder="TCH001 (Optional)" />
                            <p class="mt-1 text-xs text-text-secondary font-caption">Leave blank for auto-generation</p>
                        </div>

                    </div>

                    <!-- Password Setup -->
                    <div class="border-t border-secondary-200 pt-6">
                        <h3 class="text-sm font-semibold text-text-primary mb-4">Password Setup</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Password -->
                            <div>
                                <label for="register-password" class="form-label">Password *</label>
                                <div class="relative">
                                    <input type="password" id="register-password" name="password" class="form-input pl-10 pr-10" placeholder="Create password" required />
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                        </svg>
                                    </div>
                                    <button type="button" id="toggle-register-password" class="absolute inset-y-0 right-0 pr-3 flex items-center focus:outline-none">
                                        <svg id="register-eye-closed" class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"/>
                                        </svg>
                                        <svg id="register-eye-open" class="w-4 h-4 text-secondary-400 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Confirm Password -->
                            <div>
                                <label for="confirmPassword" class="form-label">Confirm Password *</label>
                                <div class="relative">
                                    <input type="password" id="confirmPassword" name="confirmPassword" class="form-input pl-10" placeholder="Confirm password" required />
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <svg class="w-4 h-4 text-secondary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Password Requirements -->
                        <div class="mt-3 text-xs text-text-secondary font-caption">
                            <p>Password must contain at least:</p>
                            <ul class="ml-4 mt-1 space-y-1 list-disc">
                                <li>8 characters long</li>
                                <li>1 uppercase letter</li>
                                <li>1 lowercase letter</li>
                                <li>1 number</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="border-t border-secondary-200 pt-6">
                        <div class="flex items-start space-x-3">
                            <input id="terms" name="terms" type="checkbox" class="mt-1 h-4 w-4 text-accent focus:ring-accent-500 border-secondary-300 rounded" required />
                            <label for="terms" class="text-sm text-text-secondary font-caption">
                                I agree to the <a href="#" class="text-primary hover:text-primary-700 underline">Terms of Service</a> and 
                                <a href="#" class="text-primary hover:text-primary-700 underline">Privacy Policy</a>. I understand that my registration 
                                will be reviewed by the administrator before activation.
                            </label>
                        </div>
                    </div>

                    <!-- Register Button -->
                    <div>
                        <button type="submit" id="register-btn" class="w-full btn-primary py-3 text-base font-medium relative overflow-hidden">
                            <span id="register-text">Create Account</span>
                            <div id="register-spinner" class="hidden absolute inset-0 flex items-center justify-center">
                                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                                </svg>
                            </div>
                        </button>
                    </div>
                </form>
            </div>


            <!-- Trust Signals -->
            <div class="mt-8 text-center space-y-4">
                <div class="flex items-center justify-center space-x-6">
                    <!-- SSL Badge -->
                    <div class="flex items-center space-x-2 text-xs text-text-secondary">
                        <svg class="w-4 h-4 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                        </svg>
                        <span class="font-caption">SSL Secured</span>
                    </div>
                    
                    <!-- Privacy Badge -->
                    <div class="flex items-center space-x-2 text-xs text-text-secondary">
                        <svg class="w-4 h-4 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        <span class="font-caption">Data Protected</span>
                    </div>

                    <!-- GDPR Compliant -->
                    <div class="flex items-center space-x-2 text-xs text-text-secondary">
                        <svg class="w-4 h-4 text-success-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="font-caption">Privacy Compliant</span>
                    </div>
                </div>

                <!-- Footer -->
                <div class="text-xs text-text-secondary font-caption">
                    <p>¬© 2025 BVIT SALARY SLIP. All Rights Reserved.</p>
                    <p class="mt-1">Secure Payroll Management for Educational Institutions</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentMode = 'login';
        let registeredTeachers = [];
        let googleSheetsDB = null;

        // DOM elements
        const loginModeBtn = document.getElementById('login-mode-btn');
        const registerModeBtn = document.getElementById('register-mode-btn');
        const loginFormCard = document.getElementById('login-form-card');
        const registrationFormCard = document.getElementById('registration-form-card');
        const loginHelp = document.getElementById('login-help');
        const registerHelp = document.getElementById('register-help');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            // Wait a bit for all scripts to load before initializing
            setTimeout(async () => {
                await initializeServerAPI();
                await loadRegisteredTeachers();
            }, 100);
        });

        // Initialize Firebase integration
        async function initializeServerAPI() {
            try {
                // Initialize Firebase if not already initialized
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                console.log('‚úÖ Firebase initialized successfully');
            } catch (error) {
                console.log('üîÑ Firebase initialization error:', error);
            }
        }

        // Event listeners setup
        function setupEventListeners() {
            // Mode switching
            loginModeBtn.addEventListener('click', () => switchMode('login'));
            registerModeBtn.addEventListener('click', () => switchMode('register'));

            // Login form
            document.getElementById('teacher-login-form').addEventListener('submit', handleLogin);
            document.getElementById('toggle-login-password').addEventListener('click', () => togglePassword('login'));

            // Registration form
            document.getElementById('teacher-registration-form').addEventListener('submit', handleRegistration);
            document.getElementById('toggle-register-password').addEventListener('click', () => togglePassword('register'));

            // Password validation
            document.getElementById('register-password').addEventListener('input', validatePassword);
            document.getElementById('confirmPassword').addEventListener('input', validatePasswordMatch);

            // Auto-focus
            document.getElementById('login-teacherId').focus();
        }

        // Switch between login and register modes
        function switchMode(mode) {
            currentMode = mode;
            
            if (mode === 'login') {
                // Update buttons
                loginModeBtn.classList.add('bg-white', 'text-primary', 'shadow-subtle');
                loginModeBtn.classList.remove('text-text-secondary');
                registerModeBtn.classList.remove('bg-white', 'text-primary', 'shadow-subtle');
                registerModeBtn.classList.add('text-text-secondary');
                
                // Show/hide forms
                loginFormCard.classList.remove('hidden');
                registrationFormCard.classList.add('hidden');
                
                // Show/hide help content
                loginHelp.classList.remove('hidden');
                registerHelp.classList.add('hidden');
                
                // Focus on login field
                setTimeout(() => document.getElementById('login-teacherId').focus(), 100);
            } else {
                // Update buttons
                registerModeBtn.classList.add('bg-white', 'text-primary', 'shadow-subtle');
                registerModeBtn.classList.remove('text-text-secondary');
                loginModeBtn.classList.remove('bg-white', 'text-primary', 'shadow-subtle');
                loginModeBtn.classList.add('text-text-secondary');
                
                // Show/hide forms
                registrationFormCard.classList.remove('hidden');
                loginFormCard.classList.add('hidden');
                
                // Show/hide help content
                registerHelp.classList.remove('hidden');
                loginHelp.classList.add('hidden');
                
                // Focus on name field
                setTimeout(() => document.getElementById('fullName').focus(), 100);
            }
        }

        // Toggle password visibility
        function togglePassword(formType) {
            const passwordInput = document.getElementById(formType === 'login' ? 'login-password' : 'register-password');
            const eyeClosed = document.getElementById(formType === 'login' ? 'login-eye-closed' : 'register-eye-closed');
            const eyeOpen = document.getElementById(formType === 'login' ? 'login-eye-open' : 'register-eye-open');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeClosed.classList.add('hidden');
                eyeOpen.classList.remove('hidden');
            } else {
                passwordInput.type = 'password';
                eyeClosed.classList.remove('hidden');
                eyeOpen.classList.add('hidden');
            }
        }

        // Handle login with Firebase Authentication
        async function handleLogin(e) {
            e.preventDefault();
            
            const teacherId = document.getElementById('login-teacherId').value.trim();
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            const loginText = document.getElementById('login-text');
            const loginSpinner = document.getElementById('login-spinner');
            const errorMessage = document.getElementById('login-error-message');
            const successMessage = document.getElementById('login-success-message');
            
            console.log('üîç Teacher login attempt:', teacherId);
            
            // Show loading state
            loginBtn.disabled = true;
            loginText.classList.add('opacity-0');
            loginSpinner.classList.remove('hidden');
            
            // Hide previous messages
            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            
            try {
                // Initialize Firebase if not already done
                if (!firebase.apps.length) {
                    firebase.initializeApp(window.FIREBASE_CONFIG || window.firebaseConfig);
                }
                
                // Try Firebase Authentication first
                let email = teacherId;
                if (!teacherId.includes('@')) {
                    // If teacher ID provided, find email from database
                    const teachersRef = firebase.database().ref('teachers');
                    const snapshot = await teachersRef.once('value');
                    const teachers = snapshot.val();
                    
                    if (teachers) {
                        const teacher = Object.values(teachers).find(t => 
                            t.id === teacherId || t.email === teacherId
                        );
                        if (teacher) {
                            email = teacher.email;
                            console.log('üìß Found teacher email:', email);
                        }
                    }
                }
                
                console.log('üîê Attempting Firebase Auth login...');
                console.log('üìß Using email:', email);
                console.log('üîë Password length:', password.length);
                
                // Sign in with Firebase Authentication
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('‚úÖ Firebase Auth successful:', user.uid);
                
                // Skip email verification check for now - allow login without verification
                console.log('üìß Email verified status:', user.emailVerified);
                if (!user.emailVerified) {
                    console.log('‚ö†Ô∏è Email not verified, but allowing login');
                    // Note: In production, you may want to enforce email verification
                }
                
                // Get teacher data from database using UID
                const teachersRef = firebase.database().ref('teachers');
                const snapshot = await teachersRef.once('value');
                const teachers = snapshot.val();
                
                let loggedInTeacher = null;
                if (teachers) {
                    loggedInTeacher = Object.values(teachers).find(t => 
                        t.uid === user.uid || t.email === user.email
                    );
                }
                
                if (!loggedInTeacher) {
                    console.log('‚ùå Teacher record not found in database');
                    await firebase.auth().signOut();
                    document.getElementById('login-error-text').textContent = 'Teacher record not found. Please contact admin.';
                    errorMessage.classList.remove('hidden');
                    return;
                }
                
                // Check if teacher is approved
                if (loggedInTeacher.status !== 'Active') {
                    console.log('‚ö†Ô∏è Teacher not approved:', loggedInTeacher.status);
                    await firebase.auth().signOut();
                    
                    if (loggedInTeacher.status === 'Pending Approval') {
                        document.getElementById('login-error-text').textContent = 'Your registration is pending admin approval. Please wait for activation.';
                    } else {
                        document.getElementById('login-error-text').textContent = 'Your account is not active. Please contact admin.';
                    }
                    errorMessage.classList.remove('hidden');
                    return;
                }
                
                console.log('üéâ Login successful for teacher:', loggedInTeacher.name);
                
                // Show success message
                document.getElementById('login-success-text').textContent = 'Login successful! Redirecting to dashboard...';
                successMessage.classList.remove('hidden');
                
                // Set session storage with teacher details
                sessionStorage.setItem('teacherLoggedIn', 'true');
                sessionStorage.setItem('loggedInTeacherId', loggedInTeacher.id);
                sessionStorage.setItem('loggedInTeacherUID', user.uid);
                sessionStorage.setItem('loggedInTeacherName', loggedInTeacher.name);
                sessionStorage.setItem('loggedInTeacherEmail', loggedInTeacher.email);
                sessionStorage.setItem('loggedInTeacherDesignation', loggedInTeacher.designation);
                sessionStorage.setItem('loggedInTeacherDepartment', loggedInTeacher.department);
                sessionStorage.setItem('loginTime', new Date().toISOString());
                
                // Redirect to teacher dashboard after short delay
                setTimeout(() => {
                    window.location.href = 'teacher_dashboard.html';
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå Login failed:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
                
                let errorText = 'Login failed. ';
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorText += 'No Firebase account found. Please contact admin to create your account.';
                        break;
                    case 'auth/wrong-password':
                        errorText += 'Incorrect password.';
                        break;
                    case 'auth/invalid-email':
                        errorText += 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorText += 'Account has been disabled.';
                        break;
                    case 'auth/too-many-requests':
                        errorText += 'Too many failed attempts. Try again later.';
                        break;
                    case 'auth/invalid-login-credentials':
                        errorText += 'Invalid email or password. Please check your credentials or contact admin if you need a Firebase account.';
                        break;
                    default:
                        errorText += error.message;
                }
                
                document.getElementById('login-error-text').textContent = errorText;
                errorMessage.classList.remove('hidden');
                
            } finally {
                // Reset button state
                loginBtn.disabled = false;
                loginText.classList.remove('opacity-0');
                loginSpinner.classList.add('hidden');
                
                // Focus back to teacher ID field
                document.getElementById('login-teacherId').focus();
            }
        }

        // Handle registration
        async function handleRegistration(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            const registerBtn = document.getElementById('register-btn');
            const registerText = document.getElementById('register-text');
            const registerSpinner = document.getElementById('register-spinner');
            const errorMessage = document.getElementById('register-error-message');
            const successMessage = document.getElementById('register-success-message');
            
            // Validate form
            if (!validateRegistrationForm(data)) {
                return;
            }
            
            // Show loading state
            registerBtn.disabled = true;
            registerText.classList.add('opacity-0');
            registerSpinner.classList.remove('hidden');
            
            // Hide previous messages
            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            
            try {
                // Check for duplicate email in localStorage only (not Firebase Auth duplicates)
                if (data.email && registeredTeachers.some(teacher => teacher && teacher.email && teacher.email.toLowerCase() === data.email.toLowerCase())) {
                    throw new Error('Email already registered in pending requests. Please use a different email address.');
                }
                
                // Generate teacher ID if not provided
                let teacherId = data.teacherId ? data.teacherId.trim() : '';
                if (!teacherId) {
                    teacherId = generateTeacherId();
                } else {
                    // Check for duplicate teacher ID
                    if (teacherId && registeredTeachers.some(teacher => teacher && teacher.id && teacher.id.toLowerCase() === teacherId.toLowerCase())) {
                        throw new Error('Teacher ID already taken. Please choose a different ID or leave blank for auto-generation.');
                    }
                }
                
                // Create Firebase Authentication account first
                let firebaseUser = null;
                try {
                    // Initialize Firebase if not already initialized
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    
                    console.log('üîê Creating Firebase Auth account for:', data.email);
                    
                    // Create Firebase Auth account
                    const userCredential = await firebase.auth().createUserWithEmailAndPassword(data.email, data.password);
                    firebaseUser = userCredential.user;
                    
                    console.log('‚úÖ Firebase Auth account created successfully:', firebaseUser.uid);
                    console.log('üìß User email:', firebaseUser.email);
                    
                    // Update user profile
                    await firebaseUser.updateProfile({
                        displayName: data.fullName
                    });
                    console.log('‚úÖ User profile updated with display name:', data.fullName);
                    
                    // Send email verification
                    await firebaseUser.sendEmailVerification();
                    console.log('üìß Email verification sent to:', firebaseUser.email);
                    
                    // Important: Do NOT sign out immediately - let the account stay active
                    console.log('‚úÖ Firebase Auth account creation complete - keeping user signed in');
                    
                } catch (authError) {
                    console.error('‚ùå Firebase Auth creation failed:', authError);
                    console.error('‚ùå Error code:', authError.code);
                    console.error('‚ùå Error message:', authError.message);
                    
                    // Handle specific Firebase Auth errors
                    if (authError.code === 'auth/email-already-in-use') {
                        console.log('‚ö†Ô∏è Email already exists in Firebase Auth');
                        throw new Error('This email is already registered. Please use a different email or contact admin.');
                    } else if (authError.code === 'auth/weak-password') {
                        throw new Error('Password is too weak. Please use at least 6 characters.');
                    } else if (authError.code === 'auth/invalid-email') {
                        throw new Error('Invalid email address format.');
                    } else {
                        throw new Error(`Account creation failed: ${authError.message}`);
                    }
                }
                
                // Create new teacher registration with Pending Approval status
                const newTeacher = {
                    id: teacherId,
                    uid: firebaseUser.uid, // Store Firebase UID for authentication linking
                    name: data.fullName,
                    email: data.email,
                    phone: data.phone,
                    address: '',
                    department: data.department,
                    designation: data.designation,
                    employmentType: 'Permanent',
                    status: 'Pending Approval', // Requires admin approval
                    basicPay: 0,
                    payScale: '',
                    payBand: '',
                    payInBand: 0,
                    agp: 0,
                    additionalAllowance: 0,
                    registrationDate: new Date().toISOString(),
                    approvedBy: null,
                    approvalDate: null,
                    authCreated: true, // Flag to indicate Firebase Auth account was created
                    emailVerificationSent: true
                };
                
                // Always save to localStorage first
                registeredTeachers.push(newTeacher);
                saveRegisteredTeachers();
                console.log('‚úÖ Teacher saved to localStorage');
                console.log('üìä Current localStorage teachers count:', registeredTeachers.length);
                console.log('üìã New teacher data:', newTeacher);
                
                // Save to Firebase database
                try {
                    // Initialize Firebase if not already initialized
                    if (!firebase.apps.length) {
                        firebase.initializeApp(firebaseConfig);
                    }
                    
                    const firebaseDB = new FirebaseDB();
                    
                    // Save teacher to Firebase
                    const teachersRef = firebase.database().ref('teachers');
                    await teachersRef.child(newTeacher.id).set(newTeacher);
                    
                    console.log('‚úÖ Teacher saved to Firebase database');
                } catch (error) {
                    console.error('‚ùå Failed to save to Firebase:', error);
                    console.log('üìù Data is safely stored in localStorage');
                }
                
                // Sign out the newly created user after successful registration
                try {
                    await firebase.auth().signOut();
                    console.log('‚úÖ User signed out after registration - admin approval required');
                } catch (signOutError) {
                    console.warn('‚ö†Ô∏è Could not sign out user:', signOutError);
                }
                
                // Show success message
                document.getElementById('register-success-text').textContent = 
                    `Registration successful! Your Teacher ID is ${teacherId}. Firebase account created and verification email sent. Please wait for admin approval.`;
                successMessage.classList.remove('hidden');
                
                // Alert admin (simulate notification)
                console.log('üîî ADMIN NOTIFICATION: New teacher registration pending approval!');
                
                // Reset form after delay
                setTimeout(() => {
                    e.target.reset();
                    switchMode('login');
                }, 3000);
                
            } catch (error) {
                // Show error message
                document.getElementById('register-error-text').textContent = error.message;
                errorMessage.classList.remove('hidden');
                
                // Reset button state
                registerBtn.disabled = false;
                registerText.classList.remove('opacity-0');
                registerSpinner.classList.add('hidden');
            }
        }

        // Validate registration form
        function validateRegistrationForm(data) {
            // Check required fields
            const requiredFields = ['fullName', 'email', 'phone', 'department', 'designation', 'password', 'confirmPassword'];
            for (const field of requiredFields) {
                if (!data[field] || data[field].trim() === '') {
                    const fieldName = field.replace(/([A-Z])/g, ' $1').toLowerCase();
                    showRegistrationError(`Please fill in the ${fieldName}`);
                    return false;
                }
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(data.email)) {
                showRegistrationError('Please enter a valid email address');
                return false;
            }

            // Phone validation
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{10,}$/;
            if (!phoneRegex.test(data.phone)) {
                showRegistrationError('Please enter a valid phone number');
                return false;
            }

            // Password validation
            if (data.password.length < 8) {
                showRegistrationError('Password must be at least 8 characters long');
                return false;
            }

            if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(data.password)) {
                showRegistrationError('Password must contain at least one uppercase letter, one lowercase letter, and one number');
                return false;
            }

            // Password match validation
            if (data.password !== data.confirmPassword) {
                showRegistrationError('Passwords do not match');
                return false;
            }

            // Terms checkbox
            if (!data.terms) {
                showRegistrationError('Please accept the terms and conditions');
                return false;
            }

            return true;
        }

        // Show registration error
        function showRegistrationError(message) {
            document.getElementById('register-error-text').textContent = message;
            document.getElementById('register-error-message').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('register-error-message').classList.add('hidden');
            }, 5000);
        }

        // Validate password strength
        function validatePassword() {
            const password = document.getElementById('register-password').value;
            const requirements = [
                { test: password.length >= 8, message: 'At least 8 characters' },
                { test: /[A-Z]/.test(password), message: '1 uppercase letter' },
                { test: /[a-z]/.test(password), message: '1 lowercase letter' },
                { test: /\d/.test(password), message: '1 number' }
            ];
            
            // You could add visual indicators here if needed
        }

        // Validate password match
        function validatePasswordMatch() {
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmField = document.getElementById('confirmPassword');
            
            if (confirmPassword && password !== confirmPassword) {
                confirmField.setCustomValidity('Passwords do not match');
            } else {
                confirmField.setCustomValidity('');
            }
        }

        // Generate unique teacher ID
        function generateTeacherId() {
            const existingIds = registeredTeachers
                .filter(teacher => teacher.id)
                .map(teacher => teacher.id)
                .concat(['TCH001', 'TCH002', 'TCH003']); // Existing ones from login

            let maxNum = 0;
            existingIds.forEach(id => {
                const match = id.match(/TCH(\d+)/);
                if (match) {
                    maxNum = Math.max(maxNum, parseInt(match[1]));
                }
            });

            return `TCH${String(maxNum + 1).padStart(3, '0')}`;
        }

        // Load registered teachers from Firebase
        async function loadRegisteredTeachers() {
            try {
                // Initialize Firebase if not already initialized
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                const firebaseDB = new FirebaseDB();
                
                // Get all teachers from Firebase
                const teachersRef = firebase.database().ref('teachers');
                const snapshot = await teachersRef.once('value');
                const teachers = snapshot.val();
                
                if (teachers) {
                    registeredTeachers = Object.values(teachers);
                    console.log('‚úÖ Loaded teachers from Firebase:', registeredTeachers.length);
                    return;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Could not load from Firebase, using localStorage:', error);
            }
            
            // Fallback to localStorage
            const stored = localStorage.getItem('teachers');
            if (stored) {
                try {
                    registeredTeachers = JSON.parse(stored);
                    console.log('‚úÖ Loaded teachers from localStorage:', registeredTeachers.length);
                } catch (e) {
                    console.error('Error loading registered teachers:', e);
                    registeredTeachers = [];
                }
            } else {
                registeredTeachers = [];
                console.log('No teachers found in localStorage, starting fresh');
            }
        }

        // Save registered teachers to localStorage (use same key as admin system)
        function saveRegisteredTeachers() {
            try {
                localStorage.setItem('teachers', JSON.stringify(registeredTeachers));
                console.log('‚úÖ Saved teachers to localStorage. Total count:', registeredTeachers.length);
                
                // Verify save worked
                const verification = JSON.parse(localStorage.getItem('teachers'));
                console.log('‚úÖ Verification - localStorage now contains:', verification.length, 'teachers');
            } catch (e) {
                console.error('‚ùå Error saving registered teachers:', e);
            }
        }

        // Input validation and styling
        const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="password"]');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.value && !this.checkValidity()) {
                    this.classList.add('border-error-500', 'focus:ring-error-500', 'focus:border-error-500');
                    this.classList.remove('border-secondary-200', 'focus:ring-accent-500', 'focus:border-accent-500');
                } else {
                    this.classList.remove('border-error-500', 'focus:ring-error-500', 'focus:border-error-500');
                    this.classList.add('border-secondary-200', 'focus:ring-accent-500', 'focus:border-accent-500');
                }
            });
            
            input.addEventListener('input', function() {
                // Hide error messages when user starts typing
                document.getElementById('login-error-message').classList.add('hidden');
                document.getElementById('login-success-message').classList.add('hidden');
                document.getElementById('register-error-message').classList.add('hidden');
                document.getElementById('register-success-message').classList.add('hidden');
            });
        });

        // Teacher ID format validation
        document.getElementById('login-teacherId').addEventListener('input', function() {
            const value = this.value.trim();
            const isEmail = value.includes('@');
            const isTeacherId = /^[A-Z]{2,3}\d{3,4}$/i.test(value);
            
            if (value && !isEmail && !isTeacherId && value.length > 3) {
                this.setCustomValidity('Please enter a valid Teacher ID (e.g., TCH001) or email address');
            } else {
                this.setCustomValidity('');
            }
        });

        // Keyboard navigation enhancement
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'BUTTON' && e.target.type !== 'submit') {
                const form = e.target.closest('form');
                if (form) {
                    const inputs = Array.from(form.querySelectorAll('input, select'));
                    const currentIndex = inputs.indexOf(e.target);
                    const nextInput = inputs[currentIndex + 1];
                    
                    if (nextInput) {
                        nextInput.focus();
                        e.preventDefault();
                    }
                }
            }
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>